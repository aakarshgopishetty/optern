<div class="opportunities-container">
  <!-- Main Header -->
  <header class="main-header">
    <h1><i class="bi bi-lightbulb"></i> Discover Your Next Opportunity</h1>
    <p>Find the perfect job that matches your skills and aspirations.</p>
  </header>

  <!-- Filter and Search Bar -->
  <div class="filter-bar">
    <div class="search-box">
      <i class="bi bi-search"></i>
      <input type="text" placeholder="Search jobs, companies, or skills..." (input)="onSearchChange($event)">
    </div>
    <div class="filter-options">
      <button class="filter-btn" (click)="toggleCategoriesDropdown()">
        <span>{{ selectedCategory }} ({{ filteredJobs.length }})</span>
        <i class="bi bi-chevron-down" [class.rotated]="showCategoriesDropdown"></i>
      </button>
      <!-- Categories Dropdown -->
      <div class="categories-dropdown" *ngIf="showCategoriesDropdown">
        <div class="dropdown-item" *ngFor="let category of categories" (click)="selectCategory(category)" [class.active]="selectedCategory === category">
          {{ category }}
        </div>
      </div>
      <div class="view-toggle">
        <button [class.active]="viewMode === 'list'" (click)="setView('list')"><i class="bi bi-list-ul"></i></button>
        <button [class.active]="viewMode === 'grid'" (click)="setView('grid')"><i class="bi bi-grid-fill"></i></button>
      </div>
      <button class="refresh-btn" (click)="refreshJobs()" title="Refresh job listings">
        <i class="bi bi-arrow-clockwise"></i>
        <span>Refresh</span>
      </button>
      <button class="filters-main-btn" (click)="toggleFiltersPanel()">
        <i class="bi bi-funnel"></i>
        <span>Filters</span>
      </button>
    </div>
  </div>

  <!-- Filters Panel -->
  <div class="filters-panel" *ngIf="showFiltersPanel">
    <div class="filters-content">
      <h3>Filter Jobs</h3>
      <div class="filter-group">
        <label>Location</label>
        <input type="text" [(ngModel)]="filters.location" placeholder="e.g., New York, Remote">
      </div>
      <div class="filter-group">
        <label>Job Type</label>
        <select [(ngModel)]="filters.jobType">
          <option value="">All Types</option>
          <option value="Full-time">Full-time</option>
          <option value="Part-time">Part-time</option>
          <option value="Contract">Contract</option>
          <option value="Internship">Internship</option>
          <option value="Microinternship">Microinternship</option>
          <option value="Freelance">Freelance</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Salary Range</label>
        <div class="salary-range">
          <input type="number" [(ngModel)]="filters.salaryMin" placeholder="Min">
          <span>to</span>
          <input type="number" [(ngModel)]="filters.salaryMax" placeholder="Max">
        </div>
      </div>
      <div class="filter-group">
        <label>
          <input type="checkbox" [(ngModel)]="filters.remoteOnly">
          Remote work only
        </label>
      </div>
      <div class="filter-actions">
        <button class="clear-btn" (click)="clearFilters()">Clear All</button>
        <button class="apply-btn" (click)="applyFilters()">Apply Filters</button>
      </div>
    </div>
  </div>

  <!-- Job Listings Header -->
  <div class="listings-header">
    <p>Found {{ filteredJobs.length }} opportunities</p>
  </div>

  <!-- Job Listings - Grid or List -->
  <div [ngSwitch]="viewMode">
    <!-- List View -->
    <div *ngSwitchCase="'list'" class="job-listings-list">
      <div class="job-card-list" *ngFor="let job of filteredJobs">
        <div class="job-card-list-header">
          <div class="company-avatar">{{ getCompanyInitials(job.company) }}</div>
          <div class="job-title-section">
            <h3 class="job-title">{{ job.title }}</h3>
            <p class="job-company">{{ job.company }}</p>
          </div>
          <div class="job-tags-and-priority">
            <div class="wishlist-icon">
              <i class="bi bi-heart"></i>
            </div>
            <span class="priority-tag" [ngClass]="job.priority.replace(' ', '-')">{{ job.priority }}</span>
          </div>
        </div>
        <div class="job-details-bar">
          <span><i class="bi bi-geo-alt"></i> {{ job.location }}</span>
          <span><i class="bi bi-briefcase"></i> {{ job.type }}</span>
          <span *ngIf="job.remote" class="remote-tag">Remote</span>
          <span><i class="bi bi-cash-stack"></i> {{ job.salary }}</span>
          <span><i class="bi bi-people"></i> {{ job.applicants }} applicants</span>
        </div>
        <div class="job-card-list-body">
          <div class="job-skills">
            <span *ngFor="let skill of job.skills" class="skill-tag">{{ skill }}</span>
          </div>
          <p class="job-description">{{ job.description }}</p>
        </div>
        <div class="job-card-list-footer">
          <div class="job-rating">
            <i class="bi bi-star-fill"></i> {{ job.rating }} &bull; {{ job.posted }}
          </div>
          <div class="job-actions">
            <button class="view-details-btn" (click)="viewJobDetails(job)">
              <i class="bi bi-eye"></i>
              View Details
            </button>
            <button [class]="getButtonClass(job)" (click)="apply(job)" [attr.data-job-id]="job.jobID" [disabled]="hasApplied(job)">
              {{ getButtonText(job) }}
              <i *ngIf="!hasApplied(job)" class="bi bi-arrow-right-short"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Grid View -->
    <div *ngSwitchCase="'grid'" class="job-listings-grid">
      <div class="job-card-grid" *ngFor="let job of filteredJobs">
        <div class="job-card-grid-header">
          <div class="company-avatar">{{ getCompanyInitials(job.company) }}</div>
          <div>
            <h3 class="job-title">{{ job.title }}</h3>
            <p class="job-company">{{ job.company }}</p>
          </div>
          <div class="wishlist-icon">
            <i class="bi bi-heart"></i>
          </div>
        </div>
        <div class="job-card-grid-priority">
          <span class="priority-tag" [ngClass]="job.priority.replace(' ', '-')">{{ job.priority }}</span>
        </div>
        <div class="job-details-grid">
            <span>{{ job.location }}</span> &bull;
            <span>{{ job.type }}</span>
            <span *ngIf="job.remote" class="remote-tag">Remote</span>
        </div>
        <div class="job-details-grid">
            <span>{{ job.salary }}</span> &bull;
            <span>{{ job.applicants }} applicants</span>
        </div>
        <p class="job-description">{{ job.description }}</p>
        <div class="job-skills">
          <span *ngFor="let skill of job.skills" class="skill-tag">{{ skill }}</span>
        </div>
        <div class="job-card-grid-footer">
          <div class="job-rating">
            <i class="bi bi-star-fill"></i> {{ job.rating }} &bull; {{ job.posted }}
          </div>
          <div class="job-actions">
            <button class="view-details-btn" (click)="viewJobDetails(job)">
              <i class="bi bi-eye"></i>
              View Details
            </button>
            <button [class]="getButtonClass(job)" (click)="apply(job)" [attr.data-job-id]="job.jobID" [disabled]="hasApplied(job)">
              {{ getButtonText(job) }}
              <i *ngIf="!hasApplied(job)" class="bi bi-arrow-right-short"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
